<! doctype html>
<html lang="en">
<head>
	<title>Pinewood Derby 3000</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
	
	<script type="text/javascript" src="Box2dWeb/Box2dWeb-2.1.a.3.min.js"></script>
	<script src="js/Three.js"></script>
	<script src="js/Detector.js"></script>
	<script src="js/THREEx.KeyboardState.js"></script>
	<script src="js/Globals.js"></script>
	<script id="defaultVertexShader" type="x-shader/x-vertex">
	// switch on high precision floats
		#ifdef GL_ES
		precision highp float;
		#endif

		void main()
		{
			gl_Position = projectionMatrix * modelViewMatrix * vec4(position,1.0);
		}
	</script>
	<script id="vertexShader1" type="x-shader/x-vertex">
		// switch on high precision floats
		#ifdef GL_ES
		precision highp float;
		#endif

		void main()
		{
			gl_Position = projectionMatrix * modelViewMatrix * vec4(position,1.0);
		}
	</script>
	<script id="vertexShader2" type="x-shader/x-vertex">
		// switch on high precision floats
		#ifdef GL_ES
		precision highp float;
		#endif

		void main()
		{
			gl_Position = projectionMatrix * modelViewMatrix * vec4(position,1.0);
		}
	</script>
	<script id="lavaVertexShader" type="x-shader/x-vertex">
		// switch on high precision floats
		#ifdef GL_ES
		precision highp float;
		#endif

		void main()
		{
			gl_Position = projectionMatrix * modelViewMatrix * vec4(position,1.0);
		}
	</script>
	<script id="car1FragShader" type="x-shader/x-fragment">
		void main()
		{
			gl_FragColor = vec4(1.0,  // R
				0.0,  // G
				1.0,  // B
				1.0); // A				  
		}
	</script>
	<script id="car2FragShader" type="x-shader/x-fragment">
		void main()
		{
			gl_FragColor = vec4(0.0,  // R
				1.0,  // G
				0.0,  // B
				1.0); // A
		}
	</script>
	<script id="car3FragShader" type="x-shader/x-fragment">
		uniform vec2 resolution;
		uniform float time;
		void main()	
		{
			vec2 p = -1.0 + 2.0 * gl_FragCoord.xy / resolution.xy;
			float a = time*40.0;
			float d,e,f,g=1.0/40.0,h,i,r,q;
			e=400.0*(p.x*0.5+0.5);
			f=400.0*(p.y*0.5+0.5);
			i=200.0+sin(e*g+a/150.0)*20.0;
			d=200.0+cos(f*g/2.0)*18.0+cos(e*g)*7.0;
			r=sqrt(pow(i-e,2.0)+pow(d-f,2.0));
			q=f/r;
			e=(r*cos(q))-a/2.0;f=(r*sin(q))-a/2.0;
			d=sin(e*g)*176.0+sin(e*g)*164.0+r;
			h=((f+d)+a/2.0)*g;
			i=cos(h+r*p.x/1.3)*(e+e+a)+cos(q*g*6.0)*(r+h/3.0);
			h=sin(f*g)*144.0-sin(e*g)*212.0*p.x;
			h=(h+(f-e)*q+sin(r-(a+h)/7.0)*10.0+i/4.0)*g;
			i+=cos(h*2.3*sin(a/350.0-q))*184.0*sin(q-(r*4.3+a/12.0)*g)+tan(r*g+h)*184.0*cos(r*g+h);
			i=mod(i/5.6,256.0)/64.0;
			if(i<0.0) i+=4.0;
			if(i>=2.0) i=4.0-i;
			d=r/350.0;
			d+=sin(d*d*8.0)*0.52;
			f=(sin(a*g)+1.0)/2.0;
			gl_FragColor=vec4(vec3(f*i/1.6,i/2.0+d/13.0,i)*d*p.x+vec3(i/1.3+d/8.0,i/2.0+d/18.0,i)*d*(1.0-p.x),1.0);
		}
	</script>
	<script id="lavaFragShader" type="x-shader/x-fragment">
		void main()
		{
			gl_FragColor = vec4(0.8,  // R
				0.4,  // G
				0.6,  // B
				1.0); // A
		}
	</script>
	<script src="js/Init.js"></script>
	<script src="js/Util.js"></script>
    <script src="js/Level.js"></script>
	<script src="js/Car.js"></script>
	<script src="js/Game.js"></script>
    <script id="trackVertexShader" type="x-shader/x-vertex">
		// switch on high precision floats
		#ifdef GL_ES
		precision highp float;
		#endif
		float random( vec2 p )
		{
				// We need irrationals for pseudo randomness.
				// Most (all?) known transcendental numbers will (generally) work.
		const vec2 r = vec2(
			23.1406926327792690,  // e^pi (Gelfond's constant)
			2.6651441426902251); // 2^sqrt(2) (Gelfondâ€“Schneider constant)
		return fract( cos( mod( 123456789., 1e-7 + 256. * dot(p,r) ) ) );  
		}
		void main()
		{
	  	gl_Position = projectionMatrix * modelViewMatrix * vec4(position.x,random(vec2(position.x,position.y))*.2 + position.y, position.z,1.0);
		//gl_Position = vec4(position,1.0);
		}
	</script>
	<script id="trackFragShader" type="x-shader/x-fragment">
		uniform vec2 resolution;
		uniform float time;
		
		void main()
		{
		   gl_FragColor = vec4(1.0,  // R
				0.0,  // G
				1.0,  // B
				1.0); // A	
			
			
		}
		
	</script>
	<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>
    <div id="container" style="display: none;">
		<h2 id="notifications"></h2>
		<h2 id="distance"></h2>
	</div>
	<!--<div id="debugDraw" style="display: none;">
		<canvas id="canvas" width="480" height="320" style="background-color:#333333;"></canvas>
	</div>-->
	<div id="startMenu" class="menuPage" style="display: block;">
		<h1>Pinewood Derby 3000</h1>
		<div class="instructions">
			<h3>Instructions</h3>
			<div>
				<p>Navigate your car down the track to reach the end.</p>
			</div>
		</div>
		<div class="controls">
			<h3>Controls</h3>
			<div>
				<p><img src="images/controls2.png" class="controlsImage" />Tilt your car forward using the <span class="controlKey">right</span> arrow.<br /><br />
				Tilt your car backward using the <span class="controlKey">left</span> arrow<br /><br />
				Press the <span class="controlKey">down</span> arrow to apply the brakes<br /></br />
				Press the <span class="controlKey">space bar</span> to restart the current level</p>
			</div>
		</div>
		<div class="startBtnWrapper">
			<button id="btnStart" type="button" onclick="startLevel(1);" >Start</button>
		</div>
	</div>
	<div id="interimMenu" class="menuPage" style="display: none;">
		<h1 id="interimHeader">Level # Complete!</h1>
		<div class="nextLevelWrapper">
			<button id="btnNextLevel" type="button">Level #</button>
		</div>
		<div class="configWrapper">
			<div class="configOption">
				<h3>Front Tires:</h3>
				<div class="btnWrapper">
					<button id="btnWheel1RadiusLow" type="button" onclick="setWheel1Radius(1);">Small</button>
					<button id="btnWheel1RadiusMed" type="button" onclick="setWheel1Radius(2);" class="selected">Medium</button>
					<button id="btnWheel1RadiusHigh" type="button"  onclick="setWheel1Radius(3);">Large</button>
				</div>
			</div>
			<div class="configOption">
				<h3>Back Tires:</h3>
				<div class="btnWrapper">
					<button id="btnWheel2RadiusLow" type="button" onclick="setWheel2Radius(1);">Small</button>
					<button id="btnWheel2RadiusMed" type="button" onclick="setWheel2Radius(2);" class="selected">Medium</button>
					<button id="btnWheel2RadiusHigh" type="button"  onclick="setWheel2Radius(3);">Large</button>
				</div>
			</div>
			<div class="configOption">
				<h3>Body Mass:</h3>
				<div class="btnWrapper">
					<button id="btnCarDensityLow" type="button" onclick="setCarDensity(1);">Light</button>
					<button id="btnCarDensityMed" type="button" onclick="setCarDensity(2);" class="selected">Medium</button>
					<button id="btnCarDensityHigh" type="button"  onclick="setCarDensity(3);">Heavy</button>
				</div>
			</div>
			<div class="configOption">
				<h3>Suspension:</h3>
				<div class="btnWrapper">
					<button id="btnSuspensionLow" type="button" onclick="setSuspension(1);">Low</button>
					<button id="btnSuspensionMed" type="button" onclick="setSuspension(2);" class="selected">Medium</button>
					<button id="btnSuspensionHigh" type="button"  onclick="setSuspension(3);">High</button>
				</div>
			</div>
			<div class="configOption">
				<h3>Tire Friction:</h3>
				<div class="btnWrapper">
					<button id="btnWheelFrictionLow" type="button" onclick="setWheelFriction(1);">Low</button>
					<button id="btnWheelFrictionMed" type="button" onclick="setWheelFriction(2);" class="selected">Medium</button>
					<button id="btnWheelFrictionHigh" type="button"  onclick="setWheelFriction(3);">High</button>
				</div>
			</div>
		</div>
	</div>
	<div id="endMenu" class="menuPage" style="display: none;">
		<h1>Congratulations!</h1>
		<h3>You win!</h3>
	</div>
</body>
</html>

